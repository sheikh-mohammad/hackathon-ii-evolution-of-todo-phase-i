# Implementation Plan: Intermediate Ticklisto Enhancements

**Branch**: `002-intermediate-ticklisto-enhancements` | **Date**: 2026-02-01 | **Updated**: 2026-02-03 | **Spec**: [spec.md](./spec.md)
**Input**: Feature specification from `/specs/002-intermediate-ticklisto-enhancements/spec.md`

**Note**: This plan is generated by the `/sp.plan` command following the Spec-Driven Development workflow.

## Summary

This feature enhances the existing Ticklisto console application with intermediate-level organization and usability features. The primary requirements include:
- **Required priority and categories**: Task creation MUST require priority level (high/medium/low) and at least one category tag
- Adding priority levels (high/medium/low) and category tags to tasks
- Implementing search and filter functionality by keyword (with scope selection: title/description/both), status, priority, and date
- Adding sort capabilities by due date, priority, and alphabetically
- Providing a clear command to properly reset the terminal buffer (not just scroll)
- Providing a delete all command with confirmation prompt

The technical approach leverages Python 3.13+ with the Rich library for enhanced CLI formatting, using JSON file persistence (ticklisto_data.json) and maintaining backward compatibility with existing basic task operations.

## Technical Context

**Language/Version**: Python 3.14+
**Primary Dependencies**: Rich (CLI formatting), UV (package management), python-dateutil (date parsing)
**Storage**: JSON file persistence (ticklisto_data.json) - data survives application restarts
**Task Identity**: Auto-incrementing integer IDs (1, 2, 3, ...) - never reused during normal operation, reset to 1 after "delete all"
**Testing**: Pytest with TDD approach (Red-Green-Refactor cycle)
**Target Platform**: Console application (local development environment)
**Project Type**: Single project (console application)
**Performance Goals**:
- Search: <500ms for up to 1000 tasks
- Filter: <300ms for up to 1000 tasks
- Sort: <500ms for up to 1000 tasks
- Priority/category assignment: <2 seconds with visual feedback

**Constraints**:
- Backward compatibility with existing basic operations (add, delete, update, view, mark complete)
- JSON file storage (ticklisto_data.json) for persistence
- Console-based interface (no GUI)
- Must follow clean architecture principles
- Priority and categories are REQUIRED fields during task creation
- Task updates require full re-entry of all fields
- Search must support scope selection (title only, description only, or both)
- Clear command must properly clear terminal buffer (platform-specific mechanisms)

**Scale/Scope**: Up to 1000 tasks in JSON file with responsive operations

## Constitution Check

*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

### ✓ Spec-Driven Development (NON-NEGOTIABLE)
- **Status**: PASS
- **Evidence**: Feature specification exists at `specs/002-intermediate-ticklisto-enhancements/spec.md` with comprehensive requirements, user stories, and acceptance criteria

### ✓ AI-Agent Driven Implementation
- **Status**: PASS
- **Evidence**: Implementation will be executed via Claude Code following AGENTS.md workflow

### ✓ Progressive Complexity Evolution
- **Status**: PASS
- **Evidence**: This is a Phase I enhancement, building upon existing basic console application functionality without introducing web/cloud complexity

### ⚠ Reusable Intelligence & Modularity
- **Status**: NEEDS VERIFICATION IN PHASE 1
- **Action Required**: Design must ensure modular components for search, filter, sort, and validation that can be reused in future phases

### ⚠ Test-First (NON-NEGOTIABLE)
- **Status**: NEEDS VERIFICATION IN PHASE 2
- **Action Required**: Tasks.md must include test creation before implementation for each feature

### ✓ Atomic Commits
- **Status**: PASS
- **Evidence**: Process requirement - will be enforced during implementation

### ✓ Co-authoring with Claude Code
- **Status**: PASS
- **Evidence**: Process requirement - all commits will include co-author attribution

### ⚠ Clean Architecture & Separation of Concerns
- **Status**: NEEDS VERIFICATION IN PHASE 1
- **Action Required**: Design must maintain clear separation between:
  - Data models (Task entity with new attributes)
  - Business logic (search, filter, sort operations)
  - CLI interface (Rich formatting and user interaction)
  - Validation logic (priority and category validation)

### Technology Stack Compliance
- **Status**: PASS
- **Evidence**:
  - Python 3.13+ ✓
  - UV for package management ✓
  - Pytest for testing ✓
  - Rich for CLI interfaces ✓
  - In-memory storage ✓
  - Git for version control ✓

**GATE RESULT**: CONDITIONAL PASS - Proceed to Phase 0 with verification requirements for modularity, test-first approach, and clean architecture to be validated in subsequent phases.

## Project Structure

### Documentation (this feature)

```text
specs/002-intermediate-ticklisto-enhancements/
├── spec.md              # Feature specification (complete)
├── plan.md              # This file (/sp.plan command output)
├── research.md          # Phase 0 output (to be generated)
├── data-model.md        # Phase 1 output (to be generated)
├── quickstart.md        # Phase 1 output (to be generated)
├── contracts/           # Phase 1 output (to be generated)
└── tasks.md             # Phase 2 output (/sp.tasks command - NOT created by /sp.plan)
```

### Source Code (repository root)

```text
src/
├── __init__.py
├── __main__.py
├── ticklisto/
│   ├── __init__.py
|   ├── __main__.py
│   ├── models/
│   │   ├── __init__.py
│   │   └── task.py              # Task entity with ID, priority, categories, due_date
│   ├── services/
│   │   ├── __init__.py
│   │   ├── task_manager.py      # Core task operations (existing)
│   │   ├── storage_service.py   # NEW: JSON file persistence (ticklisto_data.json)
│   │   ├── id_manager.py        # NEW: Auto-incrementing ID management
│   │   ├── search_service.py    # NEW: Search functionality with scope selection
│   │   ├── filter_service.py    # NEW: Filter operations
│   │   ├── sort_service.py      # NEW: Sort operations
│   │   └── validation_service.py # NEW: Priority and category validation
|   ├── ui/
|   |   ├── __init__.py
|   |   ├── rich_ui.py
|   |   ├── animations.py
|   |   ├── components.py
│   ├── cli/
│   │   ├── __init__.py
│   │   ├── commands.py          # CLI command handlers (enhanced with delete all, clear)
│   │   ├── display.py           # Rich formatting utilities (enhanced)
│   │   └── parsers.py           # NEW: Date and input parsing
│   └── utils/
│       ├── __init__.py
│       ├── date_parser.py       # NEW: Flexible date parsing utility
│       └── terminal_utils.py    # NEW: Platform-specific terminal clearing
│
tests/
├── unit/
│   ├── test_task_model.py       # Task entity tests (enhanced with ID)
│   ├── test_storage_service.py  # NEW: JSON persistence tests
│   ├── test_id_manager.py       # NEW: ID management tests
│   ├── test_search_service.py   # NEW: Search tests (with scope)
│   ├── test_filter_service.py   # NEW: Filter tests
│   ├── test_sort_service.py     # NEW: Sort tests
│   ├── test_validation_service.py # NEW: Validation tests
│   ├── test_date_parser.py      # NEW: Date parsing tests
│   └── test_terminal_utils.py   # NEW: Terminal clearing tests
├── integration/
│   ├── test_task_operations.py  # End-to-end task operations (enhanced)
│   ├── test_search_filter_integration.py # NEW: Combined search/filter tests
│   ├── test_persistence.py      # NEW: JSON file persistence integration tests
│   └── test_cli_commands.py     # NEW: CLI command integration tests
└── contract/
    └── test_backward_compatibility.py # NEW: Ensure existing features work
```

**Structure Decision**: Single project structure is appropriate for this Phase I console application. The design maintains clear separation of concerns with distinct layers for models, services, CLI interface, and utilities. New functionality is added as separate service modules to maintain modularity and testability. JSON file persistence is handled by a dedicated storage service, and ID management is isolated in its own module.

## Complexity Tracking

> **Fill ONLY if Constitution Check has violations that must be justified**

No violations requiring justification. All constitution requirements are met or have clear verification paths in subsequent phases.

## Phase 0: Research & Unknowns Resolution

**Status**: PENDING

### Research Tasks

The following areas require research to resolve unknowns and establish best practices:

1. **JSON File Persistence Strategy**
   - **Unknown**: Best approach for reading/writing JSON file (ticklisto_data.json) with atomic operations to prevent data corruption
   - **Research Needed**: File locking mechanisms, atomic write patterns (write to temp + rename), error handling for corrupted files
   - **Decision Criteria**: Data safety, performance, cross-platform compatibility

2. **ID Management and Persistence**
   - **Unknown**: Best approach for persisting and managing auto-incrementing IDs across application restarts
   - **Research Needed**: Storing ID counter in JSON, handling ID reset after "delete all", ensuring ID uniqueness
   - **Decision Criteria**: Simplicity, reliability, performance

3. **Date Parsing Library Selection**
   - **Unknown**: Best approach for flexible date parsing in Python (supporting MM/DD/YYYY, DD-MM-YYYY, YYYY-MM-DD, and natural language like "tomorrow", "next week")
   - **Research Needed**: Evaluate libraries (dateutil, arrow, pendulum) vs custom implementation
   - **Decision Criteria**: Ease of use, natural language support, maintenance status, performance

4. **Rich Library Best Practices**
   - **Unknown**: Optimal patterns for implementing interactive CLI with Rich (tables, prompts, progress indicators, autocomplete)
   - **Research Needed**: Rich documentation for console clearing, table formatting with dynamic columns, autocomplete functionality, and required field prompts
   - **Decision Criteria**: User experience, performance, maintainability

5. **Platform-Specific Terminal Clearing**
   - **Unknown**: Best approach for properly clearing terminal buffer (not just scrolling) across Windows, Linux, and macOS
   - **Research Needed**: Platform detection, terminal control sequences (ANSI escape codes), subprocess calls (cls/clear), Rich library capabilities
   - **Decision Criteria**: Effectiveness, cross-platform compatibility, user experience

6. **Search Performance with Scope Selection**
   - **Unknown**: Best data structures and algorithms for efficient search with scope selection (title only, description only, both) on JSON-persisted task lists (up to 1000 tasks)
   - **Research Needed**: Python list comprehensions vs filter/map, string matching strategies, caching considerations
   - **Decision Criteria**: Performance benchmarks, code simplicity, memory efficiency

7. **Validation Strategy for Required Fields**
   - **Unknown**: Best approach for enforcing required fields (priority and categories) during task creation with good UX
   - **Research Needed**: Python validation patterns, CLI prompt libraries, error handling and retry logic
   - **Decision Criteria**: User experience, error handling, extensibility

8. **Full Re-entry Update Pattern**
   - **Unknown**: Best UX pattern for task updates requiring full re-entry of all fields
   - **Research Needed**: Displaying current values, pre-filling prompts, confirmation workflows
   - **Decision Criteria**: User experience, error prevention, efficiency

**Output**: `research.md` with decisions, rationale, and alternatives considered for each area

## Phase 1: Design & Contracts

**Status**: PENDING (requires Phase 0 completion)

### Deliverables

1. **data-model.md**: Enhanced Task entity specification with:
   - ID field (auto-incrementing integer, never reused except after "delete all")
   - Title field (string, required)
   - Description field (string, required)
   - Priority field (enum: high/medium/low, REQUIRED)
   - Categories field (list of strings, at least one REQUIRED)
   - Due date field (optional datetime)
   - Status field (completed/incomplete)
   - Validation rules for each field
   - State transitions (if applicable)

2. **contracts/**: API contracts for new operations:
   - Storage service contract (JSON file read/write, atomic operations)
   - ID manager contract (ID generation, counter persistence, reset logic)
   - Search contract (input: keyword + scope [title/description/both], output: filtered task list)
   - Filter contract (input: criteria object, output: filtered task list)
   - Sort contract (input: sort criteria, output: ordered task list)
   - Validation contract (input: field value, output: validation result)
   - Terminal utils contract (platform-specific clear operations)
   - Delete all contract (confirmation prompt, ID counter reset)

3. **quickstart.md**: Developer guide for:
   - Setting up development environment
   - Running tests
   - Adding new features
   - Understanding the architecture
   - JSON file structure and persistence patterns
   - ID management and reset behavior
   - Required field validation workflow
   - Full re-entry update pattern

4. **Agent context update**: Run `.specify/scripts/bash/update-agent-context.sh claude` to update Claude-specific context with new technologies and patterns

### Design Principles

- **Backward Compatibility**: All existing task operations must continue to work without modification
- **Data Safety**: JSON file operations must be atomic to prevent corruption
- **ID Integrity**: IDs never reused during normal operation, only reset after "delete all"
- **Required Fields**: Priority and categories must be enforced at creation time with clear error messages
- **Separation of Concerns**: Search, filter, sort, validation, storage, and ID management are separate, composable services
- **Testability**: Each service has clear inputs/outputs and can be tested independently
- **Extensibility**: New filter criteria, sort options, validation rules, and storage backends can be added without modifying existing code
- **Cross-Platform**: Terminal operations work consistently across Windows, Linux, and macOS

## Post-Phase 1 Constitution Check

*Re-evaluation after design completion*

### ✓ Spec-Driven Development (NON-NEGOTIABLE)
- **Status**: PASS
- **Evidence**: Complete specification with clarifications (Session 2026-02-03), plan, research, data model, and contracts created

### ✓ AI-Agent Driven Implementation
- **Status**: PASS
- **Evidence**: All artifacts generated via Claude Code following AGENTS.md workflow

### ✓ Progressive Complexity Evolution
- **Status**: PASS
- **Evidence**: Phase I enhancement maintains console application scope with JSON file persistence (appropriate for local CLI tool), no premature complexity

### ✓ Reusable Intelligence & Modularity
- **Status**: PASS ✓ (VERIFIED)
- **Evidence**:
  - Separate service modules: StorageService, IDManager, SearchService, FilterService, SortService, ValidationService, TerminalUtils
  - Each service has clear, single responsibility
  - Services are composable and can be used independently
  - Pure functions with well-defined contracts
  - Storage abstraction allows future migration to database without changing business logic
  - Can be reused in future phases (web UI, API, etc.)

### ✓ Test-First (NON-NEGOTIABLE)
- **Status**: PASS ✓ (VERIFIED)
- **Evidence**:
  - Quickstart.md mandates TDD workflow (Red-Green-Refactor)
  - Test requirements documented in each contract
  - Test structure defined: unit, integration, contract tests
  - Specific tests for JSON persistence, ID management, required field validation
  - Will be enforced in tasks.md (Phase 2)

### ✓ Atomic Commits
- **Status**: PASS
- **Evidence**: Process requirement documented in quickstart.md

### ✓ Co-authoring with Claude Code
- **Status**: PASS
- **Evidence**: Commit format specified in quickstart.md with co-author attribution

### ✓ Clean Architecture & Separation of Concerns
- **Status**: PASS ✓ (VERIFIED)
- **Evidence**:
  - Clear layered architecture: CLI → Service → Model → Storage
  - Models: Task entity with ID, validation rules
  - Services: Separate modules for storage, ID management, search (with scope), filter, sort, validation, terminal operations
  - CLI: Commands (including delete all, enhanced clear), display, parsers separated
  - No business logic in CLI layer
  - No UI concerns in service layer
  - Storage abstraction isolates persistence concerns
  - Well-defined interfaces (contracts)

### Technology Stack Compliance
- **Status**: PASS
- **Evidence**: All technologies from constitution used (Python 3.13+, UV, Pytest, Rich, Git) with JSON file storage (appropriate for Phase I local CLI)

**FINAL GATE RESULT**: ✓ PASS - All constitution requirements met. Design demonstrates excellent modularity, clean architecture, data safety through atomic JSON operations, proper ID management, required field enforcement, and adherence to all principles. Ready for Phase 2 (task breakdown).

## Phase 2: Task Breakdown

**Status**: READY (to be handled by `/sp.tasks` command)

This phase will be executed by the `/sp.tasks` command. The tasks will follow TDD approach with test creation before implementation.

**Prerequisites Met**:
- ✓ Phase 0: Research complete (research.md)
- ✓ Phase 1: Design complete (data-model.md, contracts/, quickstart.md)
- ✓ Constitution Check: All requirements verified

## Artifacts Generated

### Phase 0 Outputs
- ✓ `research.md` - Technical decisions for date parsing, Rich patterns, search/filter/sort, validation

### Phase 1 Outputs
- ✓ `data-model.md` - Enhanced Task entity specification with ID field and required fields
- ✓ `contracts/storage-service.md` - JSON file persistence contract
- ✓ `contracts/id-manager.md` - ID management and reset contract
- ✓ `contracts/validation-service.md` - Validation service contract (required fields)
- ✓ `contracts/filter-service.md` - Filter service contract
- ✓ `contracts/sort-service.md` - Sort service contract
- ✓ `contracts/search-service.md` - Search service contract (with scope selection)
- ✓ `contracts/terminal-utils.md` - Platform-specific terminal clearing contract
- ✓ `contracts/delete-all.md` - Delete all with confirmation and ID reset contract
- ✓ `quickstart.md` - Developer implementation guide

### Phase 2 Outputs (Pending)
- ⏳ `tasks.md` - To be generated by `/sp.tasks` command

## Summary

**Planning Status**: ✓ COMPLETE (Phases 0 and 1) - Updated 2026-02-03

**Key Decisions**:
1. **Storage**: JSON file persistence (ticklisto_data.json) for data durability across restarts
2. **Task Identity**: Auto-incrementing integer IDs (1, 2, 3...) - never reused during normal operation, reset to 1 after "delete all"
3. **Required Fields**: Priority and categories are mandatory at task creation with validation and clear error messages
4. **Task Updates**: Full re-entry of all fields required when updating tasks
5. **Search Scope**: User can specify search in title only, description only, or both fields
6. **Date Parsing**: python-dateutil for flexible format support
7. **CLI Framework**: Rich library with modular display components
8. **Terminal Clearing**: Platform-specific mechanisms (ANSI codes, subprocess calls) for proper buffer clearing
9. **Search/Filter/Sort**: Python list comprehensions (simple, performant for 1000 tasks)
10. **Validation**: Enum-based (priority) + flexible (categories) with autocomplete

**Architecture Highlights**:
- Layered architecture with clear separation of concerns
- 7 new service modules (storage, ID manager, search with scope, filter, sort, validation, terminal utils)
- Enhanced Task model with ID field and Priority enum
- JSON file persistence with atomic write operations
- Comprehensive contracts for all services
- TDD approach with 90%+ coverage requirement
- Delete all command with confirmation and ID counter reset
- Required field enforcement at creation time

**Performance Targets Met**:
- All operations designed to meet <500ms requirements for 1000 tasks
- JSON file storage sufficient for Phase I scope with atomic operations for data safety

**Next Command**: `/sp.tasks` to generate task breakdown

---

**Plan Status**: ✓ COMPLETE - Updated with clarifications from Session 2026-02-03
**Last Updated**: 2026-02-03
**Ready for**: Task breakdown via `/sp.tasks` command
